ARG FEDORA_VERSION=42

FROM ghcr.io/sttagent/evilwoods-binary-cache:latest AS binary-cache

FROM quay.io/fedora/fedora-bootc:${FEDORA_VERSION}

COPY --from=binary-cache /binaries/* /usr/local/bin/

COPY ./context/scripts/install-packages.bash /tmp/install-packages.bash

RUN --mount=type=bind,src=./context,dst=/context,relabel=shared \
  --mount=type=cache,dst=/var/cache/libdnf5 \
  bash /tmp/install-packages.bash && rm -r /tmp/*

COPY ./context/config/usr /usr
